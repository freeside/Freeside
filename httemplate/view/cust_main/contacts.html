% my %which = (
%   ''      => 'Billing',
%   'ship_' => 'Service',
% );
% foreach my $which ( '', 'ship_' ) {
%   my $pre = $cust_main->get("${which}last") ? $which : '';

<% $which{$which} %> address
<% ntable("#cccccc") %><TR><TD><% ntable("#cccccc",2) %>
<TR>
  <TD ALIGN="right">Contact name</TD>
  <TD COLSPAN=5 BGCOLOR="#ffffff">
    <% $cust_main->get("${pre}last"). ', '. $cust_main->get("${pre}first") |h %>
  </TD>
% if ( $which eq '' && $conf->exists('show_ss') ) { 
    <TD ALIGN="right">SS#</TD>
    <TD BGCOLOR="#ffffff"><% $cust_main->masked('ss') || '&nbsp' %></TD>
% } 
</TR>
<TR>
  <TD ALIGN="right">Company</TD>
  <TD COLSPAN=7 BGCOLOR="#ffffff"><% $cust_main->get("${pre}company") |h %></TD>
</TR>
<TR>
  <TD ALIGN="right">Address</TD>
  <TD COLSPAN=7 BGCOLOR="#ffffff"><% $cust_main->get("${pre}address1") |h %></TD>
</TR>

% if ( $cust_main->get("${pre}address2") ) { 
%   my $address2_label =
%     ( $conf->exists('cust_main-require_address2')
%       && ! ( $pre xor $cust_main->has_ship_address )
%     )
%       ? 'Unit&nbsp;#'
%       : '&nbsp;';

  <TR>
    <TD ALIGN="right"><% $address2_label %></TD>
    <TD COLSPAN=7 BGCOLOR="#ffffff"><% $cust_main->get("${pre}address2") |h %></TD>
  </TR>

% } 

<TR>
  <TD ALIGN="right">City</TD>
  <TD BGCOLOR="#ffffff"><% $cust_main->get("${pre}city") |h %></TD>
% if ( $cust_main->get("${pre}county") ) {
    <TD ALIGN="right">County</TD>
    <TD BGCOLOR="#ffffff"><% $cust_main->get("${pre}county") |h %></TD>
% }
  <TD ALIGN="right">State</TD>
  <TD BGCOLOR="#ffffff"><% state_label( $cust_main->get("${pre}state"), $cust_main->get("${pre}country") ) |h %></TD>
  <TD ALIGN="right">Zip</TD>
  <TD BGCOLOR="#ffffff"><% $cust_main->get("${pre}zip") %></TD>
</TR>
<TR>
  <TD ALIGN="right">Country</TD>
  <TD BGCOLOR="#ffffff"><% code2country( $cust_main->get("${pre}country") ) %></TD>
</TR>
<TR>
  <TD ALIGN="right"><% $daytime_label %></TD>
  <TD COLSPAN=3 BGCOLOR="#ffffff">
    <% include('/elements/phonenumber.html',
                  $cust_main->get("${pre}daytime"),
                  'callable'=>1
               )
    %>
  </TD>
</TR>
<TR>
  <TD ALIGN="right"><% $night_label %></TD>
  <TD COLSPAN=3 BGCOLOR="#ffffff">
    <% include('/elements/phonenumber.html',
                  $cust_main->get("${pre}night"),
                  'callable'=>1
               )
    %>
  </TD>
</TR>
<TR>
  <TD ALIGN="right">Fax</TD>
  <TD COLSPAN=3 BGCOLOR="#ffffff">
    <% $cust_main->get("${pre}fax") || '&nbsp' %>
  </TD>
</TR>
% if ( $which eq '' && $conf->exists('show_stateid') ) { 
  <TR>
    <TD ALIGN="right"><% $stateid_label %></TD>
    <TD BGCOLOR="#ffffff"><% $cust_main->masked('stateid') || '&nbsp' %></TD>
    <TD ALIGN="right"><% $stateid_state_label %></TD>
    <TD BGCOLOR="#ffffff"><% $cust_main->stateid_state || '&nbsp' %></TD>
  </TR>
% } 
</TABLE></TD></TR></TABLE>
% if ( $which ne 'ship_' ) {
<BR>
% }
% } 

<%once>

my $daytime_label = FS::Msgcat::_gettext('daytime') =~ /^(daytime)?$/
                      ? 'Day&nbsp;Phone'
                      : FS::Msgcat::_gettext('daytime');
my $night_label = FS::Msgcat::_gettext('night') =~ /^(night)?$/
                      ? 'Night&nbsp;Phone'
                      : FS::Msgcat::_gettext('night');
my $stateid_label = FS::Msgcat::_gettext('stateid') =~ /^(stateid)?$/
                      ? 'Driver&rsquo;s&nbsp;License'
                      : FS::Msgcat::_gettext('stateid');
my $stateid_state_label = FS::Msgcat::_gettext('stateid_state') =~ /^(stateid_state)?$/
                      ? 'Driver&rsquo;s&nbsp;License State'
                      : FS::Msgcat::_gettext('stateid_state');

</%once>
<%init>

my( $cust_main ) = @_;
my $conf = new FS::Conf;

</%init>

