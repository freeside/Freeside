#!/usr/bin/perl
#!/usr/bin/perl -w

use strict;
use Email::Send;
use FS::UID qw( adminsuidsetup );
use FS::Cron::check qw(
  check_queued check_selfservice check_apache check_bop_failures
  check_sg check_sgng
  alert error_msg
);

my $user = shift or die &usage;
my @emails = @ARGV;
#die "no notification email given" unless @emails;

eval { adminsuidsetup $user };

if ( $@ ) { alert("Database down: $@", @emails); exit; }

check_queued       or alert('Queue daemon not running', @emails);
check_selfservice  or alert(error_msg(), @emails);
check_apache       or alert('Apache not running: '. error_msg(), @emails);

#no-ops unless you are sg
check_sg           or alert('FS::ClientAPI::SG not responding',   @emails);
check_sgng         or alert('FS::ClientAPI::SGNG not responding', @emails);

check_bop_failures or alert(error_msg(), @emails);

